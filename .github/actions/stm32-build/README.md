# STM32 Build Action

A composite GitHub Action for building STM32 firmware using the ARM GCC toolchain (`arm-none-eabi-gcc`).

## Features

- ARM GCC toolchain auto-installation (xPack)
- Makefile and CMake support
- Automatic HEX/BIN generation
- Size analysis
- Static analysis integration
- Artifact preparation

## Usage

### Basic Usage

```yaml
- uses: bauer-group/automation-templates/.github/actions/stm32-build@main
  with:
    build-system: makefile
```

### Full Configuration

```yaml
- uses: bauer-group/automation-templates/.github/actions/stm32-build@main
  with:
    build-system: makefile
    target-mcu: STM32F407VG
    project-path: ./firmware
    build-type: Release
    create-hex: true
    create-bin: true
    enable-analysis: true
    generate-artifacts: true
```

## Inputs

| Input | Description | Default |
|-------|-------------|---------|
| `config-file` | Configuration template name | `default` |
| `build-system` | Build system (makefile/cmake) | `makefile` |
| `toolchain-version` | ARM GCC version | `13.3.rel1` |
| `target-mcu` | Target MCU | - |
| `project-path` | Project directory | `.` |
| `build-type` | Build type (Release/Debug) | `Release` |
| `extra-build-args` | Additional build arguments | - |
| `run-tests` | Run unit tests | `false` |
| `enable-analysis` | Run static analysis | `false` |
| `create-hex` | Generate HEX file | `true` |
| `create-bin` | Generate BIN file | `true` |
| `generate-artifacts` | Prepare artifacts | `true` |

## Outputs

| Output | Description |
|--------|-------------|
| `build-status` | Build status (success/failure) |
| `binary-path` | Path to built binaries |
| `flash-size` | Flash usage in bytes |
| `ram-size` | RAM usage in bytes |
| `version` | Firmware version string |

## Supported Build Systems

### Makefile (STM32CubeMX)

Standard Makefile generated by STM32CubeMX:

```
project/
├── Makefile
├── Core/
│   ├── Inc/
│   └── Src/
├── Drivers/
└── startup_stm32*.s
```

### CMake

Requires a toolchain file for cross-compilation:

```cmake
set(CMAKE_SYSTEM_NAME Generic)
set(CMAKE_SYSTEM_PROCESSOR ARM)
set(CMAKE_C_COMPILER arm-none-eabi-gcc)
```

## Example Workflow

```yaml
name: STM32 Build

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - name: Build Firmware
        id: build
        uses: bauer-group/automation-templates/.github/actions/stm32-build@main
        with:
          target-mcu: STM32F407VG
          build-type: Release

      - name: Upload Artifacts
        uses: actions/upload-artifact@v6
        with:
          name: firmware
          path: ${{ steps.build.outputs.binary-path }}
```

## Resources

- [ARM GNU Toolchain](https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads)
- [xPack ARM Toolchain](https://xpack.github.io/arm-none-eabi-gcc/)
- [STM32CubeMX](https://www.st.com/en/development-tools/stm32cubemx.html)
