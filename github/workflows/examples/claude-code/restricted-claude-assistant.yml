# Restricted Claude Code Assistant
# Only specific users/teams can trigger Claude
# Copy this file to .github/workflows/claude-code.yml in your repository

name: Claude Code Assistant (Restricted)

on:
  issue_comment:
    types: [created]
  pull_request_review_comment:
    types: [created]
  issues:
    types: [opened, assigned]
  pull_request_review:
    types: [submitted]

jobs:
  claude:
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'pull_request_review' && contains(github.event.review.body, '@claude')) ||
      (github.event_name == 'issues' && (contains(github.event.issue.body, '@claude') || contains(github.event.issue.title, '@claude')))

    uses: bauer-group/automation-templates/.github/workflows/claude-code.yml@main
    with:
      model: 'opus'
      trigger-phrase: '@claude'

      # Restrict to specific users (comma-separated)
      allowed-users: 'admin-user,lead-developer,security-team-member'

      # Or restrict to specific teams
      # allowed-teams: 'core-team,security'

      # Only respond to issues/PRs with these labels
      # allowed-labels: 'claude-enabled,needs-ai-review'

      # Rate limiting
      rate-limit-per-issue: 5           # Max 5 invocations per issue/hour
      rate-limit-per-user: 10           # Max 10 invocations per user/hour

    secrets:
      CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
