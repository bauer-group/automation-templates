name: Docker Simple Build Example
# Example: Basic Docker build workflow using the automation-templates system
# This example demonstrates a simple Docker build with minimal configuration
#
# Security Note:
# The docker-build action runs security scans BEFORE pushing to the registry.
# If vulnerabilities above the threshold are found, the push is blocked.
# This prevents vulnerable images from being published.
#
# Publishes to: GitHub Container Registry (ghcr.io)
# Authentication: Automatic via GITHUB_TOKEN

on:
  push:
    branches: [main, develop]
    tags: ['v*.*.*']
  pull_request:
    branches: [main]
    paths:
      - 'Dockerfile'
      - 'src/**'
      - '.dockerignore'

permissions:
  packages: write
  security-events: write

jobs:
  docker-build:
    name: Build Docker Image
    uses: bauer-group/automation-templates/.github/workflows/docker-build.yml@main
    with:
      # Publish to GitHub Container Registry (default)
      # Options: 'ghcr' (default), 'dockerhub', 'both'
      publish-to: 'ghcr'

      # Image configuration
      ghcr-image-name: 'my-simple-app'

      # Build settings
      dockerfile-path: './Dockerfile'
      docker-context: '.'

      # Auto-generate tags based on Git refs
      auto-tags: true
      latest-tag: true

      # Push to registry (skip on PRs)
      push: ${{ github.event_name != 'pull_request' }}

      # Security scanning - runs BEFORE push
      # If CRITICAL vulnerabilities are found, the push is blocked
      security-scan: true
      security-fail-on: 'CRITICAL'

    # Uses automatic GITHUB_TOKEN for GHCR authentication
    secrets: inherit
