# ðŸ”„ VollstÃ¤ndige CI/CD Pipeline mit README und Release
# Dieses Beispiel zeigt professionelle Automatisierung fÃ¼r Projekte

name: ðŸ”„ Complete CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # TÃ¤glich um 02:00 UTC fÃ¼r README-Updates
    - cron: '0 2 * * *'
  workflow_dispatch:
    inputs:
      force-readme-update:
        description: "README auch ohne Ã„nderungen aktualisieren"
        type: boolean
        default: false
      force-release:
        description: "Release auch ohne Conventional Commits erstellen"
        type: boolean
        default: false

permissions:
  contents: write
  pull-requests: write
  issues: write

jobs:
  # README-Management
  readme-management:
    name: ðŸ“„ Documentation
    if: |
      github.event_name == 'schedule' ||
      contains(github.event.head_commit.modified, 'docs/README.template.MD') ||
      github.event_name == 'workflow_dispatch' ||
      github.event_name == 'pull_request'
    uses: bauer-group/automation-templates/github/workflows/readme.yml@main
    with:
      template-path: "docs/README.template.MD"
      output-path: "README.MD"
      project-name: "Mein VollstÃ¤ndiges Projekt"
      company-name: "Meine Firma"
      project-description: "Ein professionelles Projekt mit vollstÃ¤ndiger CI/CD Pipeline"
      contact-email: "support@example.com"
      documentation-url: "https://docs.example.com"
      support-url: "https://support.example.com"
      force-update: ${{ inputs.force-readme-update || false }}
      validate-output: true
      auto-commit: ${{ github.event_name != 'pull_request' }}

  # Release-Management
  release-management:
    name: ðŸš€ Release
    if: |
      (github.event_name == 'push' && github.ref == 'refs/heads/main') ||
      (github.event_name == 'workflow_dispatch' && inputs.force-release)
    needs: readme-management
    runs-on: ubuntu-latest
    outputs:
      release_created: ${{ steps.release.outputs.release_created }}
      tag_name: ${{ steps.release.outputs.tag_name }}
      version: ${{ steps.release.outputs.version }}
    
    steps:
      - name: ðŸš€ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ“¦ Release Please
        id: release
        uses: bauer-group/automation-templates/.github/actions/release-please@main
        with:
          release-type: "simple"
          package-name: "mein-vollstaendiges-projekt"
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ“Š Release Summary
        if: steps.release.outputs.release_created == 'true'
        run: |
          echo "ðŸŽ‰ New release created!"
          echo "ðŸ“‹ Details:"
          echo "  â€¢ Version: ${{ steps.release.outputs.version }}"
          echo "  â€¢ Tag: ${{ steps.release.outputs.tag_name }}"
          echo "  â€¢ Release URL: ${{ steps.release.outputs.html_url }}"

  # Test-Suite (Beispiel)
  test-suite:
    name: ðŸ§ª Tests
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request' || github.event_name == 'push'
    
    steps:
      - name: ðŸš€ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ§ª Run Tests
        run: |
          echo "ðŸ§ª Running test suite..."
          # Hier wÃ¼rden echte Tests laufen
          echo "âœ… All tests passed"

      - name: ðŸ“Š Test Summary
        run: |
          echo "### ðŸ§ª Test Results" >> $GITHUB_STEP_SUMMARY
          echo "âœ… All tests passed" >> $GITHUB_STEP_SUMMARY

  # Deployment (nur nach erfolgreichem Release)
  deployment:
    name: ðŸš€ Deploy
    if: needs.release-management.outputs.release_created == 'true'
    needs: [release-management, test-suite]
    runs-on: ubuntu-latest
    environment: production
    
    steps:
      - name: ðŸš€ Deploy Application
        run: |
          echo "ðŸš€ Deploying version ${{ needs.release-management.outputs.version }}..."
          # Hier wÃ¼rde das echte Deployment stattfinden
          echo "âœ… Deployment completed successfully"

      - name: ðŸ“Š Deployment Summary
        run: |
          echo "### ðŸš€ Deployment Summary" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Successfully deployed version ${{ needs.release-management.outputs.version }}" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ·ï¸ Git Tag: ${{ needs.release-management.outputs.tag_name }}" >> $GITHUB_STEP_SUMMARY

  # Notification (finale Zusammenfassung)
  notification:
    name: ðŸ“¢ Notification
    if: always()
    needs: [readme-management, release-management, test-suite, deployment]
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“Š Pipeline Summary
        run: |
          echo "### ðŸ”„ Pipeline Execution Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Job | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-----|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ“„ Documentation | ${{ needs.readme-management.result || 'skipped' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸš€ Release | ${{ needs.release-management.result || 'skipped' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ§ª Tests | ${{ needs.test-suite.result || 'skipped' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸš€ Deployment | ${{ needs.deployment.result || 'skipped' }} |" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ needs.release-management.outputs.release_created }}" = "true" ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "ðŸŽ‰ **New release created: ${{ needs.release-management.outputs.version }}**" >> $GITHUB_STEP_SUMMARY
          fi

# ðŸ“‹ Pipeline-Features:
# âœ… Automatische README-Generierung und -Updates
# âœ… Intelligentes Release-Management mit Conventional Commits
# âœ… Automatisierte Tests vor Deployment
# âœ… Umgebungsbasierte Deployments
# âœ… Umfassende Benachrichtigungen und Summaries
# âœ… Cron-basierte regelmÃ¤ÃŸige Updates
# âœ… Manuelle Trigger mit Optionen
